<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Esquiva Mangonio</title>
  <style>
    body {
      margin: 0;
      background: #def;
      overflow: hidden;
      font-family: sans-serif;
    }
    canvas {
      display: block;
      margin: auto;
      background: #b2ebf2;
      border: 5px solid #333;
    }
    #gameOver, #winMessage {
      position: absolute;
      top: 30%;
      width: 100%;
      text-align: center;
      font-size: 2em;
      color: red;
      display: none;
      z-index: 15;
    }
    #score {
      position: absolute;
      top: 10px;
      left: 20px;
      font-size: 20px;
      font-weight: bold;
      z-index: 15;
    }
    #skinButton, #rouletteButton {
      position: absolute;
      bottom: 20px;
      font-size: 16px;
      padding: 10px 20px;
      background-color: #333;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 15;
    }
    #skinButton {
      left: 20px;
    }
    #rouletteButton {
      right: 20px;
    }
    #skinMenu, #rouletteMenu {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      border: 2px solid #000;
      padding: 20px;
      z-index: 20;
      max-width: 600px;
      width: 90%;
      max-height: 70vh;
      overflow-y: auto;
      box-shadow: 0 0 15px rgba(0,0,0,0.5);
    }
    .skin-option {
      display: inline-block;
      width: 120px;
      margin: 10px;
      text-align: center;
    }
    .skin-option img {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border: 2px solid #000;
      border-radius: 10px;
    }
    .skin-option button {
      margin-top: 5px;
      padding: 5px 10px;
      cursor: pointer;
    }
    #closeMenu, #closeRouletteMenu {
      position: absolute;
      top: 5px;
      right: 10px;
      font-size: 18px;
      background: red;
      color: white;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
    }
    .reward-display {
      text-align: center;
      margin-top: 20px;
    }
    .reward-display img {
      width: 100px;
      height: 100px;
    }
    .reward-display button {
      margin-top: 10px;
      padding: 10px 20px;
      cursor: pointer;
    }

    /* Contador de monedas arriba a la derecha */
    #coinDisplay {
      position: absolute;
      top: 10px;
      right: 20px;
      display: flex;
      align-items: center;
      font-size: 20px;
      font-weight: bold;
      background-color: rgba(255,255,255,0.8);
      padding: 5px 10px;
      border-radius: 15px;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
      z-index: 20;
    }
    #coinIcon {
      width: 24px;
      height: 24px;
      margin-right: 8px;
    }
  </style>
</head>
<body>
  <div id="gameOver">Haz muerto, Mangonio estÃ¡ muy triste ðŸ˜­<br>Presiona "R" para reiniciar</div>
  <div id="winMessage">Ganaste, Mangonio estÃ¡ orgulloso ðŸš‰<br>Puntaje mÃ¡ximo alcanzado</div>
  <div id="score">Puntos: 0</div>
  <button id="skinButton">Skins</button>
  <button id="rouletteButton"><img src="ruleta.png" alt="Ruleta" width="30" height="30"/>Ruleta</button>
  <div id="skinMenu"><button id="closeMenu">X</button></div>
  <div id="rouletteMenu"><button id="closeRouletteMenu">X</button>
    <div style="text-align: center;">
      <img src="ruleta.png" alt="Ruleta" style="width:200px;"><br>
      <p>Â¡Gira la ruleta para ganar una recompensa cada 30 minutos!</p>
      <ul style="text-align: left;">
        <li>200 Mango Coins</li>
        <li>400 Mango Coins</li>
        <li>800 Mango Coins</li>
        <li>2400 Mango Coins</li>
        <li>Skin: Mangonio Frozen</li>
        <li>Skin: Mangonio FaraÃ³n</li>
        <li>Skin: RenÃ© Cromo</li>
      </ul>
      <button id="spinRoulette">Girar</button>
      <div class="reward-display" id="rewardDisplay"></div>
    </div>
  </div>

  <div id="coinDisplay">
    <img src="coin.png" alt="Mango Coins" id="coinIcon">
    <span id="coinCount">0</span>
  </div>

  <canvas id="game" width="800" height="300"></canvas>

  <script>
    // ----------------------------
    // SISTEMA DE MONEDAS
    // ----------------------------

    function getCoins() {
      return parseInt(localStorage.getItem("mangoCoins")) || 0;
    }

    function setCoins(amount) {
      localStorage.setItem("mangoCoins", amount);
      updateCoinDisplay();
    }

    function addCoins(amount) {
      const current = getCoins();
      setCoins(current + amount);
    }

    function updateCoinDisplay() {
      document.getElementById("coinCount").textContent = getCoins();
    }

    // ----------------------------
    // SISTEMA DE SKINS Y RULETA
    // ----------------------------

    const skins = [
      { name: "Mangonio", file: "mangonio.png" },
      { name: "Mangonio Fino", file: "mangoniofino.png" },
      { name: "RenÃ©", file: "RenÃ©.png" },
      { name: "Gil", file: "gil.png" },
      { name: "Pablito", file: "pablito.png" },
      { name: "Kuchau", file: "kuchau.png" },
      { name: "Polariza", file: "polariza.png" },
      { name: "Gil Shiny", file: "GilShiny.png", requiresCode: true },
      { name: "mangonio.exe", file: "mangonio.exe.png" },
      { name: "Mangonio Frozen", file: "mangoniofrozen.png", rewardOnly: true },
      { name: "Mangonio FaraÃ³n", file: "mangoniofaraon.png", rewardOnly: true },
      { name: "RenÃ© Cromo", file: "renecromo.png", rewardOnly: true }
    ];

    let unlockedSkins = JSON.parse(localStorage.getItem('unlockedSkins') || '[]');
    const mangonioImg = new Image();
    mangonioImg.src = skins[0].file;

    const skinMenu = document.getElementById("skinMenu");
    const skinButton = document.getElementById("skinButton");
    const closeMenu = document.getElementById("closeMenu");
    const rouletteMenu = document.getElementById("rouletteMenu");
    const rouletteButton = document.getElementById("rouletteButton");
    const closeRouletteMenu = document.getElementById("closeRouletteMenu");
    const spinRoulette = document.getElementById("spinRoulette");
    const rewardDisplay = document.getElementById("rewardDisplay");

    skinButton.onclick = showSkinMenu;
    closeMenu.onclick = () => skinMenu.style.display = "none";
    rouletteButton.onclick = () => rouletteMenu.style.display = "block";
    closeRouletteMenu.onclick = () => rouletteMenu.style.display = "none";

    function showSkinMenu() {
      skinMenu.innerHTML = '<button id="closeMenu">X</button>';
      skins.forEach(skin => {
        if (skin.rewardOnly && !unlockedSkins.includes(skin.name)) return;
        const div = document.createElement("div");
        div.className = "skin-option";
        div.innerHTML = `
          <img src="${skin.file}" alt="${skin.name}" />
          <div>${skin.name}</div>
          <button>Seleccionar</button>
        `;
        div.querySelector("button").onclick = () => {
          if (skin.requiresCode) {
            const code = prompt("Introduce el cÃ³digo para desbloquear esta skin:");
            if (code !== "GilGuapo") return alert("CÃ³digo incorrecto");
          }
          mangonioImg.src = skin.file;
          skinMenu.style.display = "none";
        };
        skinMenu.appendChild(div);
      });
      document.getElementById("closeMenu").onclick = () => skinMenu.style.display = "none";
      skinMenu.style.display = "block";
    }

    const rewards = [
      { type: 'coins', amount: 200 },
      { type: 'coins', amount: 400 },
      { type: 'coins', amount: 800 },
      { type: 'coins', amount: 2400 },
      { type: 'skin', name: 'Mangonio Frozen', file: 'mangoniofrozen.png' },
      { type: 'skin', name: 'Mangonio FaraÃ³n', file: 'mangoniofaraon.png' },
      { type: 'skin', name: 'RenÃ© Cromo', file: 'renecromo.png' }
    ];

    spinRoulette.onclick = () => {
      const lastSpin = parseInt(localStorage.getItem('lastRouletteSpin') || '0');
      if (Date.now() - lastSpin < 30 * 60 * 1000) {
        return alert("Debes esperar 30 minutos entre giros");
      }
      localStorage.setItem('lastRouletteSpin', Date.now().toString());
      const reward = rewards[Math.floor(Math.random() * rewards.length)];
      rewardDisplay.innerHTML = '';
      if (reward.type === 'coins') {
        rewardDisplay.innerHTML = `
          <p>Â¡Has ganado ${reward.amount} Mango Coins!</p>
          <img src="coin.png" alt="Coins">
          <button id="claimCoinsBtn">Reclamar</button>
        `;
        document.getElementById('claimCoinsBtn').onclick = () => {
          addCoins(reward.amount);
          rouletteMenu.style.display = 'none';
        };
      } else {
        if (!unlockedSkins.includes(reward.name)) {
          unlockedSkins.push(reward.name);
          localStorage.setItem('unlockedSkins', JSON.stringify(unlockedSkins));
        }
        rewardDisplay.innerHTML = `
          <p>Â¡Has desbloqueado la skin: ${reward.name}!</p>
          <img src="${reward.file}" alt="${reward.name}">
          <button id="claimSkinBtn">Reclamar</button>
        `;
        document.getElementById('claimSkinBtn').onclick = () => {
          rouletteMenu.style.display = 'none';
        };
      }
    };

    // ----------------------------
    // LÃ³gica bÃ¡sica del juego para que no se quede en azul
    // (Ejemplo simple para que el canvas se vea funcional)
    // ----------------------------

    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    let player = { x: 50, y: 150, width: 50, height: 50, speed: 5 };
    let obstacles = [];
    let score = 0;
    let gameOver = false;

    function spawnObstacle() {
      const size = 30 + Math.random() * 20;
      obstacles.push({ x: canvas.width, y: Math.random() * (canvas.height - size), width: size, height: size, speed: 3 + Math.random() * 3 });
    }

    function resetGame() {
      obstacles = [];
      score = 0;
      gameOver = false;
      updateScore();
    }

    function updateScore() {
      document.getElementById('score').textContent = `Puntos: ${score}`;
    }

    function gameLoop() {
      if (gameOver) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Dibuja jugador (usar imagen de skin)
      ctx.drawImage(mangonioImg, player.x, player.y, player.width, player.height);

      // Mueve y dibuja obstÃ¡culos
      obstacles.forEach((ob, index) => {
        ob.x -= ob.speed;
        ctx.fillStyle = 'red';
        ctx.fillRect(ob.x, ob.y, ob.width, ob.height);

        // ColisiÃ³n simple
        if (
          player.x < ob.x + ob.width &&
          player.x + player.width > ob.x &&
          player.y < ob.y + ob.height &&
          player.y + player.height > ob.y
        ) {
          gameOver = true;
          document.getElementById('gameOver').style.display = 'block';
        }

        // Si sale de pantalla, suma puntos y elimina obstÃ¡culo
        if (ob.x + ob.width < 0) {
          obstacles.splice(index, 1);
          score++;
          updateScore();
          addCoins(1); // da 1 moneda por cada obstÃ¡culo evadido
        }
      });

      requestAnimationFrame(gameLoop);
    }

    // Controles simples con teclado (arriba/abajo)
    window.addEventListener('keydown', e => {
      if (gameOver && e.key.toLowerCase() === 'r') {
        document.getElementById('gameOver').style.display = 'none';
        resetGame();
        gameLoop();
      }
      if (!gameOver) {
        if (e.key === 'ArrowUp') player.y -= player.speed;
        if (e.key === 'ArrowDown') player.y += player.speed;

        // Limitar al canvas
        if (player.y < 0) player.y = 0;
        if (player.y + player.height > canvas.height) player.y = canvas.height - player.height;
      }
    });

    // Spawn obstÃ¡culos cada 1.5 segundos
    setInterval(() => {
      if (!gameOver) spawnObstacle();
    }, 1500);

    // Iniciar juego y monedas
    window.addEventListener("load", () => {
      updateCoinDisplay();
      resetGame();
      gameLoop();
    });
  </script>
</body>
</html>
