<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Esquiva RenÃ©</title>
  <style>
    body {
      margin: 0;
      background: #def;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    canvas {
      display: block;
      margin: auto;
      background: #b2ebf2;
      border: 5px solid #333;
    }
    #gameOver, #winMessage {
      position: absolute;
      top: 30%;
      width: 100%;
      text-align: center;
      font-size: 2em;
      color: red;
      display: none;
    }
    #score {
      position: absolute;
      top: 10px;
      left: 20px;
      font-size: 20px;
      font-weight: bold;
      color: #222;
      text-shadow: 1px 1px 2px white;
    }
    #controls {
      position: absolute;
      bottom: 10px;
      left: 20px;
      font-size: 16px;
      color: #333;
      background: rgba(255,255,255,0.7);
      padding: 6px 10px;
      border-radius: 8px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="gameOver">Haz muerto ðŸ˜­<br>Presiona "R" para reiniciar</div>
  <div id="winMessage">Ganaste ðŸ™‰<br>Puntaje mÃ¡ximo alcanzado</div>
  <div id="score">Puntos: 0</div>
  <div id="controls">Controles: Espacio para saltar | R para reiniciar</div>
  <canvas id="game" width="800" height="300"></canvas>
  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const scoreDisplay = document.getElementById("score");
    const gameOverText = document.getElementById("gameOver");
    const winMessage = document.getElementById("winMessage");

    const skinNormal = new Image();
    const skinMuerte = new Image();
    skinNormal.src = "rene.png";
    skinMuerte.src = "rene1.png";

    const goal = 2500;
    const floorHeight = 60;

    let rene, obstacles, flyingEnemies, speed, frame, score, gameOver, youWin, currentImg;

    function resetGame() {
      rene = {
        x: 60,
        y: canvas.height - floorHeight - 60,
        width: 50,
        height: 70,
        vy: 0,
        jumpPower: -13,
        gravity: 0.9,
        grounded: true
      };
      obstacles = [];
      flyingEnemies = [];
      speed = 6;
      frame = 0;
      score = 0;
      gameOver = false;
      youWin = false;
      currentImg = skinNormal;
      gameOverText.style.display = "none";
      winMessage.style.display = "none";
      scoreDisplay.textContent = "Puntos: 0";
      requestAnimationFrame(update);
    }

    function drawFloor() {
      ctx.fillStyle = "#f5deb3";
      ctx.fillRect(0, canvas.height - floorHeight, canvas.width, floorHeight);
    }

    function drawRene() {
      ctx.drawImage(currentImg, rene.x, rene.y, rene.width, rene.height);
    }

    function drawCactus(c) {
      ctx.fillStyle = "#2e8b57";
      ctx.fillRect(c.x, c.y, c.width, c.height);
    }

    function drawFlyingApple(fa) {
      ctx.fillStyle = "red";
      ctx.beginPath();
      ctx.arc(fa.x + 10, fa.y + 10, 10, 0, Math.PI * 2);
      ctx.fill();
      ctx.strokeStyle = "white";
      ctx.moveTo(fa.x, fa.y);
      ctx.lineTo(fa.x - 10, fa.y - 10);
      ctx.stroke();
      ctx.moveTo(fa.x + 20, fa.y);
      ctx.lineTo(fa.x + 30, fa.y - 10);
      ctx.stroke();
    }

    function drawWin() {
      ctx.font = "30px Arial";
      ctx.fillStyle = "purple";
      ctx.fillText("ðŸŽ‚", canvas.width / 2 - 15, canvas.height / 2);
      for (let i = 0; i < 100; i++) {
        ctx.fillStyle = `hsl(${Math.random() * 360}, 100%, 50%)`;
        ctx.beginPath();
        ctx.arc(Math.random() * canvas.width, Math.random() * canvas.height, 3, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function update() {
      if (gameOver || youWin) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawFloor();

      rene.vy += rene.gravity;
      rene.y += rene.vy;

      if (rene.y >= canvas.height - floorHeight - rene.height) {
        rene.y = canvas.height - floorHeight - rene.height;
        rene.vy = 0;
        rene.grounded = true;
      }

      drawRene();

      if (frame % 60 === 0) {
        obstacles.push({
          x: canvas.width,
          y: canvas.height - floorHeight - 50,
          width: 20,
          height: 50
        });
      }

      if (frame % 120 === 0) {
        flyingEnemies.push({
          x: canvas.width,
          y: 100 + Math.random() * 100,
          width: 20,
          height: 20
        });
      }

      for (let c of obstacles) {
        c.x -= speed;
        drawCactus(c);
        if (
          rene.x < c.x + c.width &&
          rene.x + rene.width > c.x &&
          rene.y + rene.height > c.y
        ) {
          gameOver = true;
          currentImg = skinMuerte;
          gameOverText.style.display = "block";
          return;
        }
      }

      for (let fa of flyingEnemies) {
        fa.x -= speed + 1;
        drawFlyingApple(fa);
        if (
          rene.x < fa.x + fa.width &&
          rene.x + rene.width > fa.x &&
          rene.y < fa.y + fa.height &&
          rene.y + rene.height > fa.y
        ) {
          gameOver = true;
          currentImg = skinMuerte;
          gameOverText.style.display = "block";
          return;
        }
      }

      obstacles = obstacles.filter(c => c.x + c.width > 0);
      flyingEnemies = flyingEnemies.filter(fa => fa.x + fa.width > 0);

      frame++;
      if (frame % 5 === 0) {
        score++;
        scoreDisplay.textContent = `Puntos: ${score}`;

        if (score % 100 === 0 && speed < 16) {
          speed += 0.5;
        }
      }

      if (score >= goal) {
        youWin = true;
        winMessage.style.display = "block";
        drawWin();
        return;
      }

      requestAnimationFrame(update);
    }

    window.addEventListener("keydown", e => {
      if (e.code === "Space" && rene.grounded && !gameOver && !youWin) {
        rene.vy = rene.jumpPower;
        rene.grounded = false;
      }
      if (e.code === "KeyR" && (gameOver || youWin)) {
        resetGame();
      }
    });

    skinNormal.onload = () => resetGame();
  </script>
</body>
</html>
