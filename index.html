<!-- ... (Todo el cÃ³digo HTML y estilos CSS lo mantengo exactamente igual) -->

<!-- Agrega esto dentro del <body>, justo antes del canvas: -->
<div id="level" style="position:absolute; top:10px; right:20px; font-size:20px; font-weight:bold;">
  Nivel: 1
</div>

<!-- El script completo con mejoras comienza aquÃ­ -->
<script>
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");
  const scoreDisplay = document.getElementById("score");
  const gameOverText = document.getElementById("gameOver");
  const winMessage = document.getElementById("winMessage");
  const skinMenu = document.getElementById("skinMenu");
  const skinButton = document.getElementById("skinButton");
  const closeMenu = document.getElementById("closeMenu");
  const levelDisplay = document.getElementById("level");

  const skins = [
    { name: "Mangonio", file: "mangonio.png" },
    { name: "Mangonio Fino", file: "mangoniofino.png" },
    { name: "RenÃ©", file: "RenÃ©.png" },
    { name: "Gil", file: "gil.png" },
    { name: "Pablito", file: "pablito.png" },
    { name: "Kuchau", file: "kuchau.png" },
    { name: "Polariza", file: "polariza.png" },
    { name: "Gil Shiny", file: "GilShiny.png", requiresCode: true },
    { name: "Golden Mangonio", file: "GoldenMangonio.png" },
    { name: "IronGonio", file: "IronGonio.png" },
    { name: "mangonio.exe", file: "mangonio.exe.png" }
  ];

  let mangonioImg = new Image();
  mangonioImg.src = skins[0].file;

  let mangonio, obstacles, speed, frame, score, gameOver, youWin, level;
  let speedStartTime = 0;
  let isCrouching = false;

  function resetGame() {
    mangonio = {
      x: 60,
      y: canvas.height - 60 - 70,
      width: 50,
      height: 70,
      vy: 0,
      jumpPower: -13,
      gravity: 0.9,
      grounded: true,
      hitboxReduction: 0.9,
      normalHeight: 70,
      crouchHeight: 35
    };

    obstacles = [];
    speed = 6;
    frame = 0;
    score = 0;
    gameOver = false;
    youWin = false;
    speedStartTime = performance.now();
    level = 1;
    updateBackground();
    updateLevelDisplay();
    gameOverText.style.display = "none";
    winMessage.style.display = "none";
    scoreDisplay.textContent = "Puntos: 0";

    requestAnimationFrame(update);
  }

  function updateLevelDisplay() {
    levelDisplay.textContent = `Nivel: ${level}`;
  }

  function updateBackground() {
    if (level === 1) {
      canvas.style.background = "#b2ebf2";
    } else if (level === 2) {
      canvas.style.background = "#c8e6c9";
    } else if (level === 3) {
      canvas.style.background = "#ffe0b2";
    }
  }

  function drawFloor() {
    ctx.fillStyle = "#f5deb3";
    ctx.fillRect(0, canvas.height - 60, canvas.width, 60);
  }

  function drawMangonio() {
    ctx.drawImage(mangonioImg, mangonio.x, mangonio.y, mangonio.width, mangonio.height);
  }

  function drawCactus(cactus) {
    ctx.fillStyle = "#2e8b57";
    ctx.fillRect(cactus.x, cactus.y, cactus.width, cactus.height);
    ctx.fillRect(cactus.x - 10, cactus.y + 10, 8, 20);
    ctx.fillRect(cactus.x + cactus.width, cactus.y + 10, 8, 20);
  }

  function drawWin() {
    ctx.font = "30px Arial";
    ctx.fillStyle = "purple";
    ctx.fillText("ðŸŽ‚", canvas.width / 2 - 15, canvas.height / 2);
    for (let i = 0; i < 100; i++) {
      ctx.fillStyle = `hsl(${Math.random() * 360}, 100%, 50%)`;
      ctx.beginPath();
      ctx.arc(Math.random() * canvas.width, Math.random() * canvas.height, 3, 0, Math.PI * 2);
      ctx.fill();
    }
  }

  function update() {
    if (gameOver || youWin) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawFloor();

    if (isCrouching && mangonio.grounded) {
      mangonio.height = mangonio.crouchHeight;
      mangonio.y = canvas.height - 60 - mangonio.height;
    } else if (mangonio.height !== mangonio.normalHeight) {
      mangonio.height = mangonio.normalHeight;
      mangonio.y = canvas.height - 60 - mangonio.height;
    }

    mangonio.vy += mangonio.gravity;
    mangonio.y += mangonio.vy;
    if (mangonio.y >= canvas.height - 60 - mangonio.height) {
      mangonio.y = canvas.height - 60 - mangonio.height;
      mangonio.vy = 0;
      mangonio.grounded = true;
    }

    drawMangonio();

    if (frame % 60 === 0) {
      obstacles.push({ x: canvas.width, y: canvas.height - 110, width: 20, height: 50 });
    }

    for (let i = 0; i < obstacles.length; i++) {
      let c = obstacles[i];
      c.x -= speed;
      drawCactus(c);

      const shrink = 0.9;
      const mx = mangonio.x + mangonio.width * (1 - mangonio.hitboxReduction) / 2;
      const my = mangonio.y + mangonio.height * (1 - mangonio.hitboxReduction) / 2;
      const mw = mangonio.width * mangonio.hitboxReduction;
      const mh = mangonio.height * mangonio.hitboxReduction;

      const cx = c.x + (1 - shrink) * c.width / 2;
      const cw = c.width * shrink;

      if (mx < cx + cw && mx + mw > cx && my + mh > c.y) {
        gameOver = true;
        gameOverText.style.display = "block";
        return;
      }
    }

    obstacles = obstacles.filter(c => c.x + c.width > 0);

    frame++;
    const elapsedSeconds = (performance.now() - speedStartTime) / 1000;
    if (elapsedSeconds > 10 && speed < 8) speed = 8;

    if (frame % 5 === 0) {
      score++;
      scoreDisplay.textContent = `Puntos: ${score}`;

      // Nivel y dificultad
      if (score === 1000) {
        level = 2;
        speed += 1;
        updateLevelDisplay();
        updateBackground();
      } else if (score === 3000) {
        level = 3;
        speed += 1;
        updateLevelDisplay();
        updateBackground();
      }

      if (score % 100 === 0 && speed < 16) speed += 0.5;
    }

    if (score >= 5000) {
      youWin = true;
      winMessage.style.display = "block";
      drawWin();
      return;
    }

    requestAnimationFrame(update);
  }

  let crouchKeys = new Set();

  window.addEventListener("keydown", e => {
    if ((e.code === "Space" || e.code === "ArrowUp") && mangonio.grounded && !gameOver && !youWin) {
      mangonio.vy = mangonio.jumpPower;
      mangonio.grounded = false;
    }
    if (e.code === "ArrowDown" || e.code === "KeyB") {
      crouchKeys.add(e.code);
      isCrouching = true;
    }
    if (e.code === "KeyR" && (gameOver || youWin)) {
      resetGame();
    }
  });

  window.addEventListener("keyup", e => {
    if (e.code === "ArrowDown" || e.code === "KeyB") {
      crouchKeys.delete(e.code);
      if (crouchKeys.size === 0) {
        isCrouching = false;
      }
    }
  });

  function showSkinMenu() {
    skinMenu.innerHTML = '<button id="closeMenu">X</button>';
    skins.forEach(skin => {
      const div = document.createElement("div");
      div.className = "skin-option";
      div.innerHTML = `
        <img src="${skin.file}" alt="${skin.name}" />
        <div>${skin.name}</div>
        <button>Seleccionar</button>
      `;
      div.querySelector("button").onclick = () => {
        if (skin.requiresCode) {
          const code = prompt("Introduce el cÃ³digo para desbloquear esta skin:");
          if (code !== "GilGuapo") return alert("CÃ³digo incorrecto");
        }
        mangonioImg.src = skin.file;
        skinMenu.style.display = "none";
      };
      skinMenu.appendChild(div);
    });
    document.getElementById("closeMenu").onclick = () => skinMenu.style.display = "none";
    skinMenu.style.display = "block";
  }

  skinButton.onclick = showSkinMenu;
  mangonioImg.onload = resetGame;
</script>
