<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Esquiva Mangonio</title>
  <style>
    body {
      margin: 0;
      background: #def;
      overflow: hidden;
    }
    canvas {
      display: block;
      margin: auto;
      background: #b2ebf2;
      border: 5px solid #333;
    }
    #gameOver, #winMessage {
      position: absolute;
      top: 30%;
      width: 100%;
      text-align: center;
      font-size: 2em;
      color: red;
      display: none;
    }
    #score {
      position: absolute;
      top: 10px;
      left: 20px;
      font-size: 20px;
      font-weight: bold;
    }
    #controlsInfo {
      position: absolute;
      bottom: 10px;
      right: 10px;
      font-size: 14px;
      color: black;
      background: rgba(255,255,255,0.5);
      padding: 5px 10px;
      border-radius: 5px;
    }
    #skinSelectorUI {
      position: absolute;
      top: 0;
      right: 0;
      padding: 10px;
      background: white;
      border-left: 2px solid #ccc;
      border-bottom: 2px solid #ccc;
      display: none;
    }
    #skinSelectorUI img {
      width: 40px;
      height: 50px;
    }
    #skinButton {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 5px;
      background: #fff;
      border: 1px solid #ccc;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="gameOver">Haz muerto, Mangonio estÃ¡ muy triste ðŸ˜­<br>Presiona "R" para reiniciar</div>
  <div id="winMessage">Ganaste, Mangonio estÃ¡ orgulloso ðŸ™‰<br>Puntaje mÃ¡ximo alcanzado</div>
  <div id="score">Puntos: 0</div>
  <div id="controlsInfo">Controles: Espacio = Saltar | B = Agacharse | R = Reiniciar</div>

  <button id="skinButton">Skins</button>
  <div id="skinSelectorUI"></div>

  <canvas id="game" width="800" height="300"></canvas>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const scoreDisplay = document.getElementById("score");
    const gameOverText = document.getElementById("gameOver");
    const winMessage = document.getElementById("winMessage");
    const skinSelectorUI = document.getElementById("skinSelectorUI");
    const skinButton = document.getElementById("skinButton");

    const skins = [
      { name: "Mangonio", src: "mangonio.png" },
      { name: "Mangonio Fino", src: "mangoniofino.png" },
      { name: "RenÃ©", src: "RenÃ©.png" },
      { name: "Gil", src: "gil.png" },
      { name: "Pablito", src: "pablito.png" },
      { name: "Kuchau", src: "kuchau.png" },
      { name: "Polariza", src: "polariza.png" },
      { name: "Gil Shiny", src: "GilShiny.png", code: "GilGuapo" },
      { name: "CapiCastor", src: "capicastor.png" },
      { name: "Golden Mangonio", src: "GoldenMangonio.png" },
    ];

    let selectedSkin = skins[0].src;
    const mangonioImg = new Image();
    mangonioImg.src = selectedSkin;

    const manzanaImg = new Image();
    manzanaImg.src = "manzana.png";

    const goal = 2500;
    const floorHeight = 60;

    let mangonio, obstacles, manzanas, speed, frame, score, gameOver, youWin, crouching;

    function resetGame() {
      mangonio = {
        x: 60,
        y: canvas.height - floorHeight - 60,
        width: 50,
        height: 70,
        vy: 0,
        jumpPower: -13,
        gravity: 0.9,
        grounded: true
      };

      obstacles = [];
      manzanas = [];
      speed = 6;
      frame = 0;
      score = 0;
      gameOver = false;
      youWin = false;
      crouching = false;

      gameOverText.style.display = "none";
      winMessage.style.display = "none";
      scoreDisplay.textContent = "Puntos: 0";

      requestAnimationFrame(update);
    }

    function drawFloor() {
      ctx.fillStyle = "#f5deb3";
      ctx.fillRect(0, canvas.height - floorHeight, canvas.width, floorHeight);
    }

    function drawMangonio() {
      ctx.drawImage(mangonioImg, mangonio.x, mangonio.y, mangonio.width, mangonio.height);
    }

    function drawObstacle(c) {
      ctx.fillStyle = "#2e8b57";
      ctx.fillRect(c.x, c.y, c.width, c.height);
    }

    function drawManzana(m) {
      ctx.drawImage(manzanaImg, m.x, m.y, m.width, m.height);
    }

    function update() {
      if (gameOver || youWin) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawFloor();

      mangonio.vy += mangonio.gravity;
      mangonio.y += mangonio.vy;

      if (mangonio.y >= canvas.height - floorHeight - mangonio.height) {
        mangonio.y = canvas.height - floorHeight - mangonio.height;
        mangonio.vy = 0;
        mangonio.grounded = true;
      }

      drawMangonio();

      if (frame % 60 === 0) {
        if (Math.random() < 0.6) {
          obstacles.push({
            x: canvas.width,
            y: canvas.height - floorHeight - 50,
            width: 20,
            height: 50
          });
        } else {
          manzanas.push({
            x: canvas.width,
            y: Math.random() < 0.5 ? canvas.height - floorHeight - 120 : canvas.height - floorHeight - 70,
            width: 40,
            height: 40
          });
        }
      }

      for (let i = 0; i < obstacles.length; i++) {
        let c = obstacles[i];
        c.x -= speed;
        drawObstacle(c);

        const hitbox = {
          x: mangonio.x + 5,
          y: mangonio.y + 5,
          width: mangonio.width * 0.9,
          height: mangonio.height * 0.9,
        };

        if (
          hitbox.x < c.x + c.width &&
          hitbox.x + hitbox.width > c.x &&
          hitbox.y + hitbox.height > c.y
        ) {
          gameOver = true;
          gameOverText.style.display = "block";
          return;
        }
      }

      for (let i = 0; i < manzanas.length; i++) {
        let m = manzanas[i];
        m.x -= speed;
        drawManzana(m);

        const hitbox = {
          x: mangonio.x + 5,
          y: mangonio.y + 5,
          width: mangonio.width * 0.9,
          height: mangonio.height * 0.9,
        };

        if (
          hitbox.x < m.x + m.width &&
          hitbox.x + hitbox.width > m.x &&
          hitbox.y + hitbox.height > m.y
        ) {
          gameOver = true;
          gameOverText.style.display = "block";
          return;
        }
      }

      obstacles = obstacles.filter(c => c.x + c.width > 0);
      manzanas = manzanas.filter(m => m.x + m.width > 0);

      frame++;

      if (frame % 5 === 0) {
        score++;
        scoreDisplay.textContent = Puntos: ${score};
        if (score % 100 === 0 && speed < 16) {
          speed += 0.5;
        }
      }

      if (score >= goal) {
        youWin = true;
        winMessage.style.display = "block";
        return;
      }

      requestAnimationFrame(update);
    }

    window.addEventListener("keydown", e => {
      if (e.code === "Space" && mangonio.grounded && !gameOver && !youWin) {
        mangonio.vy = mangonio.jumpPower;
        mangonio.grounded = false;
      }
      if (e.code === "KeyR" && (gameOver || youWin)) {
        resetGame();
      }
      if (e.code === "KeyB") {
        if (!crouching && mangonio.grounded) {
          crouching = true;
          mangonio.height = 40;
          mangonio.y += 30;
        }
      }
    });

    window.addEventListener("keyup", e => {
      if (e.code === "KeyB") {
        if (crouching) {
          crouching = false;
          mangonio.y -= 30;
          mangonio.height = 70;
        }
      }
    });

    skinButton.addEventListener("click", () => {
      skinSelectorUI.innerHTML = "";
      skins.forEach(skin => {
        const img = document.createElement("img");
        img.src = skin.src;
        img.title = skin.name;
        img.onclick = () => {
          if (skin.code) {
            const pass = prompt("Ingresa el cÃ³digo secreto:");
            if (pass !== skin.code) return alert("CÃ³digo incorrecto.");
          }
          selectedSkin = skin.src;
          mangonioImg.src = selectedSkin;
        };
        skinSelectorUI.appendChild(img);
      });
      skinSelectorUI.style.display = skinSelectorUI.style.display === "none" ? "block" : "none";
    });

    mangonioImg.onload = () => {
      resetGame();
    };
  </script>
</body>
</html>
