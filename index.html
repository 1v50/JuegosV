<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Esquiva Mangonio</title>
  <style>
    body {
      margin: 0;
      background-color: #cceeff; /* azul clarito */
      font-family: Arial, sans-serif;
    }
    #gameContainer {
      position: relative;
      margin: 20px auto;
      width: 800px;
      height: 400px;
      background-color: #f0e6d2;
      border: 3px solid #5c432d;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
    #skinSelector {
      text-align: center;
      margin: 10px auto;
    }
    button {
      margin: 0 5px;
      padding: 6px 12px;
      cursor: pointer;
      background-color: #5c432d;
      color: white;
      border: none;
      border-radius: 4px;
      font-weight: bold;
    }
    button.selected {
      background-color: #9b7c3a;
    }
    #controls {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: rgba(255, 255, 255, 0.6);
      padding: 5px;
      border-radius: 5px;
    }
    .ctrl-btn {
      margin: 5px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-weight: bold;
      font-size: 20px;
    }
    #scoreDisplay {
      position: fixed;
      top: 10px;
      left: 10px;
      background: rgba(255, 255, 255, 0.7);
      padding: 5px 10px;
      border-radius: 4px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="skinSelector">
    <button id="skinDefault" class="selected">Mangonio</button>
    <button id="skinFino">Mangonio Fino</button>
    <button id="skinRene">René</button>
  </div>
  <div id="gameContainer">
    <canvas id="gameCanvas" width="800" height="400"></canvas>
    <div id="controls">
      ↑ Espacio / Flecha arriba (saltar)<br>
      ↓ Flecha abajo / B (agacharse)<br>
      R (reiniciar), T (nivel siguiente)
    </div>
    <div id="scoreDisplay">Puntaje: 0</div>
  </div>
<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const scoreDisplay = document.getElementById('scoreDisplay');

  const groundY = 350;
  let gameOver = false;
  let score = 0;
  let level = 1;
  let obstacleSpeed = 3;
  let obstacleFrequency = 0.01;
  let waterCounter = 0;
  let hydration = 100;
  let hydrationTimer = 0;

  const skins = {
    mangonio: ['mangonio.png', 'mangonio1.png'],
    mangoniofino: ['mangoniofino.png', 'mangoniofino1.png'],
    "René": ['rene.png', 'rene1.png']
  };
  let currentSkin = localStorage.getItem('selectedSkin') || 'mangonio';
  let currentImg = new Image();
  let deadImg = new Image();
  currentImg.src = skins[currentSkin][0];
  deadImg.src = skins[currentSkin][1];

  const player = {
    x: 100,
    y: groundY - 50,
    width: 50,
    height: 50,
    dy: 0,
    jumping: false,
    crouching: false,
    jumpStrength: 14.25,
    gravity: 0.8,
    shield: 100,
    isDead: false
  };

  function updateSkinButtons() {
    document.querySelectorAll('#skinSelector button').forEach(btn => btn.classList.remove('selected'));
    document.getElementById('skinDefault').classList.toggle('selected', currentSkin === 'mangonio');
    document.getElementById('skinFino').classList.toggle('selected', currentSkin === 'mangoniofino');
    document.getElementById('skinRene').classList.toggle('selected', currentSkin === 'René');
  }

  document.getElementById('skinDefault').onclick = () => {
    currentSkin = 'mangonio';
    localStorage.setItem('selectedSkin', currentSkin);
    currentImg.src = skins[currentSkin][0];
    deadImg.src = skins[currentSkin][1];
    updateSkinButtons();
  };
  document.getElementById('skinFino').onclick = () => {
    currentSkin = 'mangoniofino';
    localStorage.setItem('selectedSkin', currentSkin);
    currentImg.src = skins[currentSkin][0];
    deadImg.src = skins[currentSkin][1];
    updateSkinButtons();
  };
  document.getElementById('skinRene').onclick = () => {
    currentSkin = 'René';
    localStorage.setItem('selectedSkin', currentSkin);
    currentImg.src = skins[currentSkin][0];
    deadImg.src = skins[currentSkin][1];
    updateSkinButtons();
  };
  updateSkinButtons();

  let obstacles = [];
  let waters = [];

  function createObstacle() {
    obstacles.push({ x: canvas.width, y: groundY - 50, width: 20, height: 50 });
    waterCounter++;
    if ((level >= 2) && waterCounter % 5 === 0) {
      waters.push({ x: canvas.width, y: groundY - 30, width: 20, height: 30 });
    }
  }

  function drawPlayer() {
    const img = player.isDead ? deadImg : currentImg;
    ctx.drawImage(img, player.x, player.y, player.width, player.height);
  }

  function updatePlayer() {
    if (!player.isDead) {
      player.y += player.dy;
      player.dy += player.gravity;
      if (player.y > groundY - player.height) {
        player.y = groundY - player.height;
        player.jumping = false;
      }
    }
  }

  function detectCollisions() {
    for (let obs of obstacles) {
      if (player.x < obs.x + obs.width && player.x + player.width > obs.x && player.y < obs.y + obs.height && player.y + player.height > obs.y) {
        player.isDead = true;
      }
    }
    for (let i = waters.length - 1; i >= 0; i--) {
      const w = waters[i];
      if (player.x < w.x + w.width && player.x + player.width > w.x && player.y < w.y + w.height && player.y + player.height > w.y) {
        hydration = Math.min(100, hydration + 25);
        waters.splice(i, 1);
      }
    }
  }

  window.addEventListener('keydown', e => {
    if ((e.code === 'Space' || e.code === 'ArrowUp') && !player.jumping && !player.isDead) {
      player.dy = -player.jumpStrength;
      player.jumping = true;
    } else if (e.code === 'ArrowDown' || e.code === 'KeyB') {
      player.height = 30;
      player.crouching = true;
    } else if (e.code === 'KeyT') {
      level++;
      resetLevel();
    } else if (e.code === 'KeyR') {
      resetLevel();
    }
  });

  window.addEventListener('keyup', e => {
    if (e.code === 'ArrowDown' || e.code === 'KeyB') {
      player.height = 50;
      player.crouching = false;
    }
  });

  function simulateKey(code) {
    const e = new KeyboardEvent('keydown', { code });
    window.dispatchEvent(e);
  }

  function resetLevel() {
    player.y = groundY - 50;
    player.dy = 0;
    player.jumping = false;
    player.isDead = false;
    player.shield = 100;
    hydration = 100;
    hydrationTimer = 0;
    obstacles = [];
    waters = [];
    score = 0;
    obstacleSpeed = 3 + level;
    obstacleFrequency = 0.01 + (level * 0.002);
  }
  resetLevel();

  function update() {
    if (!player.isDead) {
      if (Math.random() < obstacleFrequency) createObstacle();
      for (let obs of obstacles) obs.x -= obstacleSpeed;
      for (let w of waters) w.x -= obstacleSpeed;
      updatePlayer();
      detectCollisions();
      if (level > 1) {
        hydrationTimer++;
        if (hydrationTimer >= 300) {
          hydration -= 5;
          hydrationTimer = 0;
          if (hydration <= 0) player.isDead = true;
        }
      }
      obstacles = obstacles.filter(o => o.x + o.width > 0);
      waters = waters.filter(w => w.x + w.width > 0);
      score += 0.1;
      scoreDisplay.textContent = 'Puntaje: ' + Math.floor(score);
    }
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#d9c99b';
    ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);

    // Escudo (niv 1) o Hidratación (niv >= 2)
    ctx.fillStyle = 'blue';
    if (level === 1) {
      ctx.fillRect(10, 10, player.shield * 2, 20);
      ctx.strokeRect(10, 10, 200, 20);
    } else {
      ctx.fillRect(10, 10, hydration * 2, 20);
      ctx.strokeRect(10, 10, 200, 20);
    }

    for (let obs of obstacles) {
      ctx.fillStyle = 'green';
      ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
    }
    for (let w of waters) {
      const img = new Image();
      img.src = 'Agua.png';
      ctx.drawImage(img, w.x, w.y, w.width, w.height);
    }

    drawPlayer();
  }

  function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
  }
  loop();
})();
</script>
</body>
</html>
