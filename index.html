<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Esquiva Mangonio</title>
  <style>
    body {
      margin: 0;
      background: #def;
      font-family: sans-serif;
      overflow: hidden;
      position: relative;
    }
    canvas {
      display: block;
      margin: auto;
      background: #b2ebf2;
      border: 5px solid #333;
      position: relative;
      z-index: 1;
    }
    #gameOver, #winMessage {
      position: absolute;
      top: 30%;
      width: 100%;
      text-align: center;
      font-size: 2em;
      color: red;
      display: none;
      z-index: 2;
    }
    #score {
      position: absolute;
      top: 10px;
      left: 20px;
      font-size: 20px;
      font-weight: bold;
      z-index: 2;
    }
  </style>
</head>
<body>
  <div id="gameOver"> Â¡GAME OVER! <br>Presiona "R" para reiniciar</div>
  <div id="winMessage">ðŸŽ‰ Â¡Felicidades, ganaste! ðŸŽ‚<br>Puntaje mÃ¡ximo alcanzado</div>
  <div id="score">Puntos: 0</div>
  <canvas id="game" width="800" height="300"></canvas>
  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const scoreDisplay = document.getElementById("score");
    const gameOverText = document.getElementById("gameOver");
    const winMessage = document.getElementById("winMessage");

    let mangonio, obstacles, speed, frame, score, gameOver, youWin;
    const goal = 1500;
    const floorHeight = 60; // altura del piso

    function resetGame() {
      mangonio = {
        x: 60,
        y: canvas.height - floorHeight - 60, // 60 es altura Mangonio
        width: 40,
        height: 60,
        vy: 0,
        jumpPower: -13,
        gravity: 0.9,
        grounded: true
      };
      obstacles = [];
      speed = 12; // velocidad rÃ¡pida
      frame = 0;
      score = 0;
      gameOver = false;
      youWin = false;
      gameOverText.style.display = "none";
      winMessage.style.display = "none";
      scoreDisplay.textContent = "Puntos: 0";
      update();
    }

    function drawFloor() {
      ctx.fillStyle = "#f5deb3"; // amarillo claro tipo arena (wheat)
      ctx.fillRect(0, canvas.height - floorHeight, canvas.width, floorHeight);
    }

    function drawMangonio() {
      const { x, y } = mangonio;
      // Cuerpo
      ctx.fillStyle = "#ffcc33";
      ctx.beginPath();
      ctx.ellipse(x + 20, y + 30, 22, 30, 0.3, 0, Math.PI * 2);
      ctx.fill();
      ctx.strokeStyle = "#996600";
      ctx.stroke();

      // Hoja
      ctx.fillStyle = "#228B22";
      ctx.beginPath();
      ctx.ellipse(x + 25, y + 5, 10, 4, 0.3, 0, Math.PI * 2);
      ctx.fill();

      // Carita
      ctx.fillStyle = "black";
      ctx.beginPath();
      ctx.arc(x + 15, y + 25, 2.5, 0, Math.PI * 2);
      ctx.arc(x + 26, y + 25, 2.5, 0, Math.PI * 2);
      ctx.fill();

      ctx.beginPath();
      ctx.arc(x + 20, y + 38, 5, 0, Math.PI);
      ctx.stroke();
    }

    function drawCactus(cactus) {
      ctx.fillStyle = "#2e8b57";
      ctx.fillRect(cactus.x, cactus.y, cactus.width, cactus.height);
      ctx.fillRect(cactus.x - 10, cactus.y + 10, 8, 20);
      ctx.fillRect(cactus.x + cactus.width, cactus.y + 10, 8, 20);
    }

    function drawWin() {
      ctx.font = "30px Arial";
      ctx.fillStyle = "purple";
      ctx.fillText("ðŸŽ‚", canvas.width / 2 - 15, canvas.height / 2);

      // confeti
      for (let i = 0; i < 100; i++) {
        ctx.fillStyle = `hsl(${Math.random() * 360}, 100%, 50%)`;
        ctx.beginPath();
        ctx.arc(Math.random() * canvas.width, Math.random() * canvas.height, 3, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function update() {
      if (gameOver || youWin) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      drawFloor();

      // fÃ­sica
      mangonio.vy += mangonio.gravity;
      mangonio.y += mangonio.vy;

      // piso
      if (mangonio.y >= canvas.height - floorHeight - mangonio.height) {
        mangonio.y = canvas.height - floorHeight - mangonio.height;
        mangonio.vy = 0;
        mangonio.grounded = true;
      }

      drawMangonio();

      // obstÃ¡culos
      if (frame % 60 === 0) {
        obstacles.push({
          x: canvas.width,
          y: canvas.height - floorHeight - 50,
          width: 20,
          height: 50
        });
      }

      for (let i = 0; i < obstacles.length; i++) {
        let c = obstacles[i];
        c.x -= speed;
        drawCactus(c);

        if (
          mangonio.x < c.x + c.width &&
          mangonio.x + mangonio.width > c.x &&
          mangonio.y + mangonio.height > c.y
        ) {
          gameOver = true;
          gameOverText.style.display = "block";
          return;
        }
      }

      obstacles = obstacles.filter(c => c.x + c.width > 0);

      frame++;
      if (frame % 5 === 0) {
        score++;
        scoreDisplay.textContent = `Puntos: ${score}`;
      }

      if (score >= goal) {
        youWin = true;
        winMessage.style.display = "block";
        drawWin();
        return;
      }

      requestAnimationFrame(update);
    }

    window.addEventListener("keydown", e => {
      if (e.code === "Space" && mangonio.grounded && !gameOver && !youWin) {
        mangonio.vy = mangonio.jumpPower;
        mangonio.grounded = false;
      }
      if (e.code === "KeyR" && (gameOver || youWin)) {
        resetGame();
      }
    });

    resetGame();
  </script>
</body>
</html>
