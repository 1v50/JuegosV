<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Esquiva Mangonio</title>
  <style>
    body {
      margin: 0;
      background: #b2ebf2;
      overflow: hidden;
    }
    canvas {
      display: block;
      margin: auto;
      background: #b2ebf2;
      border: 5px solid #333;
    }
    #gameOver, #winMessage {
      position: absolute;
      top: 30%;
      width: 100%;
      text-align: center;
      font-size: 2em;
      color: red;
      display: none;
    }
    #score {
      position: absolute;
      top: 10px;
      left: 20px;
      font-size: 20px;
      font-weight: bold;
      color: black;
      font-family: Arial, sans-serif;
    }
    #powerupTimer {
      position: absolute;
      top: 40px;
      left: 20px;
      font-size: 24px;
      font-weight: bold;
      color: red;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      display: none;
    }
    #hydrationBar {
      position: absolute;
      bottom: 10px;
      left: 20px;
      width: 200px;
      height: 20px;
      border: 2px solid #333;
      background: #ccc;
    }
    #hydrationFill {
      height: 100%;
      background: #00aaff;
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="gameOver">Haz muerto Mangonio esta muy triste游땴<br>Presiona "R" para reiniciar</div>
  <div id="winMessage">Ganaste Mangonio esta orgulloso游뗼<br>Puntaje m치ximo alcanzado</div>
  <div id="score">Puntos: 0</div>
  <div id="powerupTimer">3</div>
  <div id="hydrationBar"><div id="hydrationFill"></div></div>
  <canvas id="game" width="800" height="300"></canvas>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    const scoreDisplay = document.getElementById("score");
    const gameOverText = document.getElementById("gameOver");
    const winMessage = document.getElementById("winMessage");
    const powerupTimerDisplay = document.getElementById("powerupTimer");
    const hydrationFill = document.getElementById("hydrationFill");

    // Im치genes
    const mangonioImg = new Image();
    mangonioImg.src = "mangonio.png";

    const reneImg = new Image();
    reneImg.src = "rene.png";

    const reneDeadImg = new Image();
    reneDeadImg.src = "rene1.png";

    const manzanaImg = new Image();
    manzanaImg.src = "manzana.png";

    const botellaImg = new Image();
    botellaImg.src = "botella.png";

    const mmsImg = new Image();
    mmsImg.src = "EMANEMS.png";

    const goal = 2500;
    const floorHeight = 60;

    let player, obstacles, speed, frame, score, gameOver, youWin;
    let currentSkin = "mangonio"; // puede ser "mangonio" o "rene"
    let hydration = 100; // barra hidratacion %
    let hydrationDrainSpeed = 0; // empieza en 0 hasta nivel 2
    let powerupActive = false;
    let powerupTimer = 0;

    function resetGame() {
      player = {
        x: 60,
        y: canvas.height - floorHeight - 70,
        width: 50,
        height: 70,
        vy: 0,
        jumpPower: -13,
        gravity: 0.9,
        grounded: true,
        invulnerable: false
      };
      obstacles = [];
      speed = 6;
      frame = 0;
      score = 0;
      gameOver = false;
      youWin = false;
      hydration = 100;
      hydrationDrainSpeed = 0;
      powerupActive = false;
      powerupTimer = 0;
      currentSkin = "mangonio";

      gameOverText.style.display = "none";
      winMessage.style.display = "none";
      scoreDisplay.textContent = "Puntos: 0";
      powerupTimerDisplay.style.display = "none";
      hydrationFill.style.width = "100%";

      requestAnimationFrame(update);
    }

    function drawFloor() {
      ctx.fillStyle = "#f5deb3";
      ctx.fillRect(0, canvas.height - floorHeight, canvas.width, floorHeight);
    }

    function drawPlayer() {
      let img;
      if (gameOver) {
        if (currentSkin === "rene") {
          img = reneDeadImg;
        } else {
          img = mangonioImg; // Sin imagen de muerte para mangonio por simplicidad
        }
      } else {
        img = currentSkin === "rene" ? reneImg : mangonioImg;
      }

      ctx.drawImage(img, player.x, player.y, player.width, player.height);

      // Si est치 con powerup, colorea un poco
      if (powerupActive) {
        ctx.fillStyle = "rgba(128,0,128,0.3)";
        ctx.fillRect(player.x, player.y, player.width, player.height);
      }
    }

    function drawCactus(cactus) {
      ctx.fillStyle = "#2e8b57";
      ctx.fillRect(cactus.x, cactus.y, cactus.width, cactus.height);
      ctx.fillRect(cactus.x - 10, cactus.y + 10, 8, 20);
      ctx.fillRect(cactus.x + cactus.width, cactus.y + 10, 8, 20);
    }

    function drawManzana(manzana) {
      ctx.drawImage(manzanaImg, manzana.x, manzana.y, manzana.width, manzana.height);
    }

    function drawBotella(botella) {
      ctx.drawImage(botellaImg, botella.x, botella.y, botella.width, botella.height);
    }

    function drawMMS(mms) {
      ctx.drawImage(mmsImg, mms.x, mms.y, mms.width, mms.height);
    }

    function drawWin() {
      ctx.font = "30px Arial";
      ctx.fillStyle = "purple";
      ctx.fillText("游꾹", canvas.width / 2 - 15, canvas.height / 2);
      for (let i = 0; i < 100; i++) {
        ctx.fillStyle = `hsl(${Math.random() * 360}, 100%, 50%)`;
        ctx.beginPath();
        ctx.arc(Math.random() * canvas.width, Math.random() * canvas.height, 3, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function update() {
      if (gameOver || youWin) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawFloor();

      // F칤sica y gravedad
      player.vy += player.gravity;
      player.y += player.vy;

      if (player.y >= canvas.height - floorHeight - player.height) {
        player.y = canvas.height - floorHeight - player.height;
        player.vy = 0;
        player.grounded = true;
      }

      drawPlayer();

      // Obst치culos y objetos
      if (frame % 60 === 0) {
        // Agregar cactus en todos niveles
        obstacles.push({type: "cactus", x: canvas.width, y: canvas.height - floorHeight - 50, width: 20, height: 50});
      }

      // Nivel basado en score
      const level = Math.floor(score / 500) + 1;

      // Niveles 2+ agregan manzanas y botellas
      if (level >= 2) {
        hydrationDrainSpeed = 0.02; // empieza a bajar la barra

        if (frame % 120 === 0) {
          // manzana arriba
          obstacles.push({type: "manzana", x: canvas.width, y: canvas.height - floorHeight - 120, width: 40, height: 40, vy: 2});
        }
        if (frame % 300 === 0) {
          // botella
          obstacles.push({type: "botella", x: canvas.width, y: canvas.height - floorHeight - 40, width: 30, height: 40});
        }
      }

      // Nivel 1+ chance de M&Ms con 25% de probabilidad, max 5 cada 8 cactus
      if (level >= 1 && frame % 60 === 0) {
        // Aqu칤 se generan cactus siempre, la probabilidad de M&Ms la puedes controlar mejor si quieres
        if (Math.random() < 0.25 && obstacles.filter(o => o.type === "mms").length < 5) {
          obstacles.push({type: "mms", x: canvas.width, y: canvas.height - floorHeight - 45, width: 30, height: 30});
        }
      }

      // Mover obst치culos y objetos
      for (let i = obstacles.length - 1; i >= 0; i--) {
        let o = obstacles[i];
        o.x -= speed;
        // Manzana con alas se mueve vertical (vy)
        if (o.type === "manzana") {
          o.y += o.vy;
          if (o.y < canvas.height - floorHeight - 160 || o.y > canvas.height - floorHeight - 120) {
            o.vy = -o.vy; // subir/bajar
          }
        }

        // Colisiones
        if (collide(player, o)) {
          if (o.type === "cactus" && !player.invulnerable) {
            gameOver = true;
            gameOverText.style.display = "block";
            return;
          } else if (o.type === "botella") {
            hydration += 20;
            if (hydration > 100) hydration = 100;
            obstacles.splice(i, 1);
          } else if (o.type === "mms") {
            powerupActive = true;
            player.invulnerable = true;
            powerupTimer = 180; // 3 segundos a 60fps
            powerupTimerDisplay.style.display = "block";
            obstacles.splice(i, 1);
          }
        }

        // Remover si fuera del canvas
        if (o.x + o.width < 0) {
          obstacles.splice(i, 1);
        }
      }

      // Actualizar barra hidrataci칩n
      if (hydrationDrainSpeed > 0) {
        hydration -= hydrationDrainSpeed;
        if (hydration <= 0) {
          hydration = 0;
          gameOver = true;
          gameOverText.textContent = "Te deshidrataste 游땷 Presiona R para reiniciar";
          gameOverText.style.display = "block";
          return;
        }
        hydrationFill.style.width = hydration + "%";
      } else {
        hydrationFill.style.width = "100%";
      }

      // Actualizar powerup timer
      if (powerupActive) {
        powerupTimer--;
        powerupTimerDisplay.textContent = Math.ceil(powerupTimer / 60);
        if (powerupTimer <= 0) {
          powerupActive = false;
          player.invulnerable = false;
          powerupTimerDisplay.style.display = "none";
        }
      }

      frame++;
      if (frame % 5 === 0) {
        score++;
        scoreDisplay.textContent = `Puntos: ${score}`;

        if (score % 100 === 0 && speed < 16) {
          speed += 0.5;
        }
      }

      if (score >= goal) {
        youWin = true;
        winMessage.style.display = "block";
        drawWin();
        return;
      }

      requestAnimationFrame(update);
    }

    // Colisi칩n AABB simple
    function collide(a, b) {
      return a.x < b.x + b.width &&
             a.x + a.width > b.x &&
             a.y < b.y + b.height &&
             a.y + a.height > b.y;
    }

    window.addEventListener("keydown", e => {
      if (e.code === "Space" && player.grounded && !gameOver && !youWin) {
        player.vy = player.jumpPower;
        player.grounded = false;
      }
      if (e.code === "KeyR" && (gameOver || youWin)) {
        resetGame();
      }
    });

    // Empezar cuando todas las im치genes est칠n cargadas
    let imagesLoaded = 0;
    const totalImages = 6;
    [mangonioImg, reneImg, reneDeadImg, manzanaImg, botellaImg, mmsImg].forEach(img => {
      img.onload = () => {
        imagesLoaded++;
        if (imagesLoaded === totalImages) {
          resetGame();
        }
      };
    });
  </script>
</body>
</html>
